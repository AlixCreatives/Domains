<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CustomDomainBuilder | Hosting Simulator</title>
    <style>
        :root {
            --bg-dark: #0f1117;
            --bg-panel: #161b22;
            --bg-card: #21262d;
            --border: #30363d;
            --text-main: #c9d1d9;
            --text-muted: #8b949e;
            --accent: #238636;
            --accent-hover: #2ea043;
            --danger: #da3633;
            --blue: #58a6ff;
            --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: var(--font);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Utils */
        .hidden { display: none !important; }
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid rgba(240, 246, 252, 0.1);
            background: var(--bg-card);
            color: var(--text-main);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: 0.2s;
        }
        .btn:hover { background: var(--border); }
        .btn-primary { background: var(--accent); border-color: transparent; color: white; }
        .btn-primary:hover { background: var(--accent-hover); }
        .btn-danger { color: var(--danger); border-color: var(--border); }
        .btn-danger:hover { background: rgba(218, 54, 51, 0.1); }
        
        input, textarea, select {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 8px 12px;
            border-radius: 6px;
            width: 100%;
            font-family: monospace;
        }
        input:focus, textarea:focus { border-color: var(--blue); }

        /* Login View */
        #view-login {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at center, #1f242e 0%, #0f1117 100%);
        }
        .login-card {
            background: var(--bg-panel);
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            width: 100%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }
        .login-logo { font-size: 2rem; margin-bottom: 0.5rem; color: white; font-weight: 700; }
        .login-desc { color: var(--text-muted); margin-bottom: 2rem; font-size: 0.9rem; }
        .code-input { text-align: center; font-size: 1.5rem; letter-spacing: 4px; margin-bottom: 1rem; }

        /* Dashboard Layout */
        #view-dashboard {
            display: flex;
            height: 100vh;
            width: 100vw;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: var(--bg-panel);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 1rem;
        }
        .brand {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .brand span { color: var(--blue); }
        
        .nav-item {
            padding: 10px 12px;
            margin-bottom: 4px;
            border-radius: 6px;
            cursor: pointer;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .nav-item:hover { background: var(--bg-card); color: var(--text-main); }
        .nav-item.active { background: var(--bg-card); color: var(--text-main); font-weight: 600; border-left: 3px solid var(--blue); }
        
        .user-info {
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            background: var(--bg-dark);
        }
        
        .header {
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .page-title { font-size: 1.5rem; font-weight: 600; color: white; }

        /* Cards */
        .card {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .card h3 { margin-bottom: 1rem; font-size: 1.1rem; color: white; }

        /* File Manager */
        .file-list { margin-top: 1rem; border: 1px solid var(--border); border-radius: 6px; overflow: hidden; }
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-card);
        }
        .file-item:last-child { border-bottom: none; }
        .file-name { font-family: monospace; color: var(--blue); }
        .file-actions { display: flex; gap: 8px; }

        .editor-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .editor-modal {
            background: var(--bg-panel);
            width: 90%;
            height: 90%;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border);
        }
        .editor-header {
            padding: 10px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .editor-body { flex: 1; display: flex; }
        .code-area {
            width: 100%;
            height: 100%;
            background: #0d1117;
            color: #c9d1d9;
            border: none;
            padding: 1rem;
            font-family: 'Courier New', Courier, monospace;
            resize: none;
            font-size: 14px;
            line-height: 1.5;
        }

        /* Domain Section */
        .dns-record {
            display: grid;
            grid-template-columns: 80px 150px 1fr;
            background: #0d1117;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin-bottom: 5px;
            border: 1px solid var(--border);
        }
        .dns-header { font-weight: bold; color: var(--text-muted); font-size: 0.8rem; text-transform: uppercase; }

        /* Deploy Console */
        .console-window {
            background: #000;
            color: #0f0;
            font-family: monospace;
            padding: 1rem;
            border-radius: 6px;
            height: 200px;
            overflow-y: auto;
            border: 1px solid #333;
            margin-bottom: 1rem;
            white-space: pre-wrap;
        }
        .success-box {
            background: rgba(46, 160, 67, 0.15);
            border: 1px solid var(--accent);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
        }
        .success-link {
            display: block;
            margin-top: 10px;
            font-size: 1.2rem;
            color: var(--blue);
            text-decoration: none;
            font-weight: bold;
        }
        .success-link:hover { text-decoration: underline; }

        /* Preview Iframe */
        .preview-container {
            width: 100%;
            height: 100%;
            background: white;
            border-radius: 4px;
            overflow: hidden;
        }
        iframe { width: 100%; height: 100%; border: none; }

        /* Tabs */
        .tab-btn { margin-right: 10px; background: transparent; border: none; color: var(--text-muted); padding-bottom: 5px; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: white; border-bottom-color: var(--blue); }

    </style>
</head>
<body>

    <div id="view-login">
        <div class="login-card">
            <div class="login-logo">CustomDomainBuilder</div>
            <p class="login-desc">Enter your access code to manage your site. <br>New codes automatically create a new account.</p>
            <input type="text" id="login-code" class="code-input" placeholder="0000" maxlength="8">
            <button class="btn btn-primary" style="width: 100%" onclick="app.login()">Access Dashboard</button>
        </div>
    </div>

    <div id="view-dashboard" class="hidden">
        <nav class="sidebar">
            <div class="brand"><span>‚ö°</span> CDB Hosting</div>
            
            <div class="nav-item active" onclick="app.nav('overview')">
                <span>üìä</span> Overview
            </div>
            <div class="nav-item" onclick="app.nav('files')">
                <span>üìÅ</span> Files & Editor
            </div>
            <div class="nav-item" onclick="app.nav('domain')">
                <span>üåê</span> Domain Setup
            </div>
            <div class="nav-item" onclick="app.nav('deploy')">
                <span>üöÄ</span> Deployment
            </div>
            <div class="nav-item" onclick="app.nav('preview')">
                <span>üëÅÔ∏è</span> Live Preview
            </div>

            <div class="user-info">
                User Code: <span id="display-code" style="color:white; font-family:monospace"></span>
                <br>
                <a href="#" onclick="location.reload()" style="color: var(--danger); text-decoration: none; font-size: 12px;">Logout</a>
            </div>
        </nav>

        <main class="main-content">
            
            <section id="sect-overview">
                <div class="header">
                    <div class="page-title">Dashboard Overview</div>
                    <span id="status-badge" class="btn">Checking Status...</span>
                </div>

                <div class="card">
                    <h3>Project Configuration</h3>
                    <p style="color: var(--text-muted); margin-bottom: 10px;">Select how you want to build your site:</p>
                    <div style="display: flex; gap: 10px; margin-bottom: 1rem;">
                        <button class="btn" id="mode-upload-btn" onclick="app.setMode('upload')">üìÇ Upload Files</button>
                        <button class="btn" id="mode-url-btn" onclick="app.setMode('url')">üîó Import URL</button>
                    </div>

                    <div id="config-url-panel" class="hidden" style="margin-top: 15px; padding: 15px; background: var(--bg-dark); border-radius: 6px;">
                        <label style="font-size: 12px; color: var(--text-muted);">External Website URL</label>
                        <input type="text" id="external-url-input" placeholder="https://example.com" onchange="app.saveExternalUrl(this.value)">
                        <small style="color: var(--text-muted);">Note: Some websites block embedding via iframe.</small>
                    </div>

                    <div id="config-upload-panel" class="hidden" style="margin-top: 15px;">
                        <p style="font-size: 0.9rem;">You are in <b>File Mode</b>. Go to the "Files" tab to manage your HTML/CSS.</p>
                    </div>
                </div>

                <div class="card">
                    <h3>Quick Stats</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div style="background: var(--bg-dark); padding: 1rem; border-radius: 6px;">
                            <div style="color: var(--text-muted); font-size: 0.8rem;">Current Domain</div>
                            <div id="stat-domain" style="font-size: 1.1rem; color: var(--blue);">Not Connected</div>
                        </div>
                        <div style="background: var(--bg-dark); padding: 1rem; border-radius: 6px;">
                            <div style="color: var(--text-muted); font-size: 0.8rem;">File Count</div>
                            <div id="stat-files" style="font-size: 1.1rem;">0</div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="sect-files" class="hidden">
                <div class="header">
                    <div class="page-title">File Manager</div>
                    <label class="btn btn-primary">
                        Upload File <input type="file" hidden onchange="app.uploadFile(this)">
                    </label>
                </div>
                
                <div class="card">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <h3>Project Files</h3>
                        <button class="btn" onclick="app.createFile('new.html')">+ New File</button>
                    </div>
                    <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 1rem;">Supported: HTML, CSS, JS, Image files. Only text files are editable.</p>
                    
                    <div id="file-list-container" class="file-list">
                        </div>
                </div>
            </section>

            <section id="sect-domain" class="hidden">
                <div class="header">
                    <div class="page-title">Domains</div>
                </div>

                <div class="card">
                    <h3>Custom Domain</h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 1rem;">
                        <input type="text" id="domain-input" placeholder="example.com">
                        <button class="btn btn-primary" onclick="app.saveDomain()">Add</button>
                    </div>
                </div>

                <div id="dns-settings" class="card hidden">
                    <h3>DNS Configuration</h3>
                    <p style="color: var(--text-muted); margin-bottom: 1rem; font-size: 0.9rem;">
                        Log in to your domain registrar (GoDaddy, Namecheap, etc.) and add these records to connect <b id="dns-target-domain" style="color:white"></b>.
                    </p>

                    <div class="dns-record">
                        <div class="dns-header">Type</div>
                        <div class="dns-header">Name</div>
                        <div class="dns-header">Value</div>
                    </div>
                    <div class="dns-record">
                        <div style="color: var(--blue)">A</div>
                        <div>@</div>
                        <div>76.76.21.21</div>
                    </div>
                    <div class="dns-record">
                        <div style="color: var(--blue)">CNAME</div>
                        <div>www</div>
                        <div>customdomainbuilder.net</div>
                    </div>
                    
                    <div style="margin-top: 1rem; text-align: right;">
                        <button class="btn" onclick="alert('DNS Validated! (Simulated)')">‚ôª Verify Configuration</button>
                    </div>
                </div>
            </section>

            <section id="sect-deploy" class="hidden">
                <div class="header">
                    <div class="page-title">Deployment</div>
                </div>

                <div class="card">
                    <h3>Publish to Production</h3>
                    <p style="margin-bottom: 1rem; color: var(--text-muted);">This will bundle your files/settings and make them live on the global CDN.</p>
                    <button id="btn-deploy" class="btn btn-primary" style="width: 100%; padding: 15px;" onclick="app.deploy()">Deploy Website</button>
                </div>

                <div id="deploy-logs" class="hidden">
                    <div class="console-window" id="console-output"></div>
                    
                    <div id="deploy-success" class="success-box hidden">
                        <h2 style="color: var(--accent); margin-bottom: 0.5rem;">üöÄ Deployment Complete!</h2>
                        <p>Your website is now live worldwide.</p>
                        
                        <div style="margin-top: 20px;">
                            <span style="color: var(--text-muted); font-size: 12px;">Primary Domain</span>
                            <a href="#" id="final-link-custom" class="success-link" onclick="app.nav('preview'); return false;">...</a>
                        </div>

                        <div style="margin-top: 15px;">
                            <span style="color: var(--text-muted); font-size: 12px;">Preview URL</span>
                            <a href="#" id="final-link-preview" class="success-link" style="font-size: 0.9rem; color: var(--text-muted);" onclick="app.nav('preview'); return false;">...</a>
                        </div>
                    </div>
                </div>
            </section>

            <section id="sect-preview" class="hidden" style="height: 100%; display: flex; flex-direction: column;">
                <div class="header" style="margin-bottom: 10px;">
                    <div class="page-title">Live Preview</div>
                    <button class="btn" onclick="app.refreshPreview()">‚Üª Refresh</button>
                </div>
                <div class="preview-container">
                    <iframe id="site-frame" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
                </div>
            </section>

        </main>
    </div>

    <div id="editor-overlay" class="editor-overlay hidden">
        <div class="editor-modal">
            <div class="editor-header">
                <span id="editor-filename" style="font-weight: bold;">index.html</span>
                <div>
                    <button class="btn" onclick="app.closeEditor()">Cancel</button>
                    <button class="btn btn-primary" onclick="app.saveFileContent()">Save Changes</button>
                </div>
            </div>
            <div class="editor-body">
                <textarea id="file-editor-content" class="code-area" spellcheck="false"></textarea>
            </div>
        </div>
    </div>

    <script>
        /**
         * CustomDomainBuilder Logic
         * Handles User State, LocalStorage, File System Simulation, and UI Routing
         */
        class CustomDomainBuilder {
            constructor() {
                this.currentUser = null;
                this.data = {
                    code: null,
                    mode: 'upload', // 'upload' or 'url'
                    externalUrl: '',
                    customDomain: '',
                    files: [], // { name, content, type }
                    published: false
                };
                this.editorActiveFileIndex = -1;
            }

            // --- Auth & Init ---

            login() {
                const codeInput = document.getElementById('login-code');
                const code = codeInput.value.trim();

                if (!code) {
                    alert("Please enter a code.");
                    return;
                }

                this.data.code = code;
                this.loadData();
                
                // UI Switch
                document.getElementById('view-login').classList.add('hidden');
                document.getElementById('view-dashboard').classList.remove('hidden');
                document.getElementById('display-code').innerText = code;
                
                // Init View
                this.updateUI();
                this.nav('overview');
            }

            loadData() {
                const key = `cdb_user_${this.data.code}`;
                const stored = localStorage.getItem(key);
                
                if (stored) {
                    this.data = JSON.parse(stored);
                } else {
                    // Initialize Default Data for new user
                    this.data.files = [
                        { 
                            name: 'index.html', 
                            content: '<html>\n<head>\n<style>\n  body { font-family: sans-serif; text-align: center; padding: 50px; background: #f0f0f0; }\n  h1 { color: #333; }\n</style>\n</head>\n<body>\n  <h1>Hello World!</h1>\n  <p>Welcome to my hosted site.</p>\n</body>\n</html>', 
                            type: 'text/html' 
                        }
                    ];
                    this.saveData();
                }
            }

            saveData() {
                const key = `cdb_user_${this.data.code}`;
                localStorage.setItem(key, JSON.stringify(this.data));
                this.updateUI();
            }

            // --- Navigation ---

            nav(sectionId) {
                // Hide all sections
                document.querySelectorAll('main > section').forEach(el => el.classList.add('hidden'));
                document.getElementById(`sect-${sectionId}`).classList.remove('hidden');

                // Update Sidebar
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                // Simple matching based on click handler usage in HTML (index mapping would be cleaner but this works)
                const items = document.querySelectorAll('.nav-item');
                if(sectionId === 'overview') items[0].classList.add('active');
                if(sectionId === 'files') items[1].classList.add('active');
                if(sectionId === 'domain') items[2].classList.add('active');
                if(sectionId === 'deploy') items[3].classList.add('active');
                if(sectionId === 'preview') {
                    items[4].classList.add('active');
                    this.renderPreview();
                }
            }

            updateUI() {
                // Mode Buttons
                const upBtn = document.getElementById('mode-upload-btn');
                const urlBtn = document.getElementById('mode-url-btn');
                
                if (this.data.mode === 'upload') {
                    upBtn.classList.add('btn-primary');
                    urlBtn.classList.remove('btn-primary');
                    document.getElementById('config-upload-panel').classList.remove('hidden');
                    document.getElementById('config-url-panel').classList.add('hidden');
                } else {
                    urlBtn.classList.add('btn-primary');
                    upBtn.classList.remove('btn-primary');
                    document.getElementById('config-upload-panel').classList.add('hidden');
                    document.getElementById('config-url-panel').classList.remove('hidden');
                }

                // Inputs
                document.getElementById('external-url-input').value = this.data.externalUrl || '';
                document.getElementById('domain-input').value = this.data.customDomain || '';
                
                // Stats
                const domainDisplay = this.data.customDomain ? `www.${this.data.customDomain}` : 'Not Connected';
                document.getElementById('stat-domain').innerText = domainDisplay;
                document.getElementById('stat-files').innerText = this.data.files.length;
                
                // Status Badge
                const badge = document.getElementById('status-badge');
                if(this.data.published) {
                    badge.innerText = "‚óè LIVE";
                    badge.style.color = "var(--accent)";
                    badge.style.borderColor = "var(--accent)";
                } else {
                    badge.innerText = "‚óã Offline";
                    badge.style.color = "var(--text-muted)";
                    badge.style.borderColor = "var(--border)";
                }

                // Domain DNS
                if(this.data.customDomain) {
                    document.getElementById('dns-settings').classList.remove('hidden');
                    document.getElementById('dns-target-domain').innerText = this.data.customDomain;
                } else {
                    document.getElementById('dns-settings').classList.add('hidden');
                }

                this.renderFileList();
            }

            // --- Configuration ---

            setMode(mode) {
                this.data.mode = mode;
                this.saveData();
            }

            saveExternalUrl(url) {
                this.data.externalUrl = url;
                this.saveData();
            }

            saveDomain() {
                const val = document.getElementById('domain-input').value.trim();
                if(val && (val.includes('.com') || val.includes('.net') || val.includes('.io') || val.includes('.org'))) {
                    this.data.customDomain = val;
                    this.saveData();
                } else {
                    alert("Please enter a valid domain (e.g. mysite.com)");
                }
            }

            // --- File Management ---

            renderFileList() {
                const container = document.getElementById('file-list-container');
                container.innerHTML = '';

                this.data.files.forEach((file, index) => {
                    const div = document.createElement('div');
                    div.className = 'file-item';
                    div.innerHTML = `
                        <div class="file-name">${file.name}</div>
                        <div class="file-actions">
                            ${file.type.startsWith('text/') ? `<button class="btn" onclick="app.editFile(${index})">Edit</button>` : ''}
                            <button class="btn btn-danger" onclick="app.deleteFile(${index})">√ó</button>
                        </div>
                    `;
                    container.appendChild(div);
                });
            }

            createFile(name = 'new-file.html') {
                const newName = prompt("Enter file name:", name);
                if(newName) {
                    this.data.files.push({
                        name: newName,
                        content: '',
                        type: 'text/html'
                    });
                    this.saveData();
                }
            }

            deleteFile(index) {
                if(confirm("Delete this file?")) {
                    this.data.files.splice(index, 1);
                    this.saveData();
                }
            }

            uploadFile(input) {
                const file = input.files[0];
                if(!file) return;

                const reader = new FileReader();
                
                // If text
                if (file.type.match('text.*') || file.name.endsWith('.js') || file.name.endsWith('.json')) {
                    reader.onload = (e) => {
                        this.data.files.push({
                            name: file.name,
                            content: e.target.result,
                            type: file.type || 'text/plain'
                        });
                        this.saveData();
                    };
                    reader.readAsText(file);
                } else {
                    // Try Base64 for images
                    reader.onload = (e) => {
                        // Limit size for localStorage sanity (approx 2MB limit check)
                        if(e.target.result.length > 2000000) {
                            alert("File too large for simulator storage.");
                            return;
                        }
                        this.data.files.push({
                            name: file.name,
                            content: e.target.result,
                            type: file.type
                        });
                        this.saveData();
                    };
                    reader.readAsDataURL(file);
                }
                input.value = ''; // reset
            }

            editFile(index) {
                this.editorActiveFileIndex = index;
                const file = this.data.files[index];
                document.getElementById('editor-filename').innerText = file.name;
                document.getElementById('file-editor-content').value = file.content;
                document.getElementById('editor-overlay').classList.remove('hidden');
            }

            closeEditor() {
                document.getElementById('editor-overlay').classList.add('hidden');
                this.editorActiveFileIndex = -1;
            }

            saveFileContent() {
                if(this.editorActiveFileIndex > -1) {
                    const content = document.getElementById('file-editor-content').value;
                    this.data.files[this.editorActiveFileIndex].content = content;
                    this.saveData();
                    this.closeEditor();
                }
            }

            // --- Deployment ---

            deploy() {
                document.getElementById('deploy-logs').classList.remove('hidden');
                document.getElementById('deploy-success').classList.add('hidden');
                document.getElementById('btn-deploy').disabled = true;
                
                const consoleEl = document.getElementById('console-output');
                consoleEl.innerText = "";
                
                const logs = [
                    "Initializing build environment...",
                    "Cloning repository...",
                    `Fetching files... (${this.data.files.length} files found)`,
                    "Running build command...",
                    "Optimizing assets...",
                    "Generating static pages...",
                    "Uploading to Edge Network (Region: us-east-1)...",
                    "Verifying DNS propagation...",
                    "Finalizing deployment..."
                ];

                let i = 0;
                const interval = setInterval(() => {
                    if (i >= logs.length) {
                        clearInterval(interval);
                        this.finishDeploy();
                    } else {
                        const line = document.createElement('div');
                        line.innerText = `> ${logs[i]}`;
                        consoleEl.appendChild(line);
                        consoleEl.scrollTop = consoleEl.scrollHeight;
                        i++;
                    }
                }, 800);
            }

            finishDeploy() {
                this.data.published = true;
                this.saveData();
                document.getElementById('btn-deploy').disabled = false;
                
                const successBox = document.getElementById('deploy-success');
                successBox.classList.remove('hidden');
                
                // Set Links
                const userLink = `https://preview.customdomainbuilder.com/${this.data.code}`;
                const customLink = this.data.customDomain 
                    ? `https://www.${this.data.customDomain}` 
                    : userLink;

                const linkCustomEl = document.getElementById('final-link-custom');
                linkCustomEl.innerText = customLink;
                // Note: We don't actually navigate to the real URL because it's fake. 
                // Clicking triggers the internal preview via onclick.
                
                document.getElementById('final-link-preview').innerText = userLink;
            }

            // --- Preview Engine ---

            refreshPreview() {
                this.renderPreview();
            }

            renderPreview() {
                const iframe = document.getElementById('site-frame');
                
                if (this.data.mode === 'url') {
                    if (this.data.externalUrl) {
                        iframe.src = this.data.externalUrl;
                    } else {
                        // blank data uri
                        iframe.src = 'about:blank';
                    }
                } else {
                    // Construction Mode (Blob)
                    // We need to construct a blob that references other files if possible. 
                    // For a simple simulator, we will just render 'index.html' and inject basic styles.
                    // Resolving relative paths (like <img src="cat.png">) inside a blob is hard without Service Workers.
                    // We will do a basic replacement for images stored in localStorage.
                    
                    const indexFile = this.data.files.find(f => f.name === 'index.html');
                    
                    if (!indexFile) {
                        iframe.srcdoc = "<h1 style='font-family:sans-serif; text-align:center; margin-top:50px;'>404: index.html not found</h1>";
                        return;
                    }

                    let content = indexFile.content;

                    // Simple Asset Replacement for relative paths
                    this.data.files.forEach(f => {
                        if(f.type.startsWith('image/')) {
                            // Replace "cat.png" with "data:image/png;base64,..."
                            const regex = new RegExp(f.name, 'g');
                            content = content.replace(regex, f.content);
                        }
                        if(f.name.endsWith('.css')) {
                             // Inject CSS
                             content = content.replace(`<link rel="stylesheet" href="${f.name}">`, `<style>${f.content}</style>`);
                        }
                        if(f.name.endsWith('.js')) {
                            // Inject JS
                            content = content.replace(`<script src="${f.name}"></script>`, `<script>${f.content}<\/script>`);
                        }
                    });

                    const blob = new Blob([content], { type: 'text/html' });
                    iframe.src = URL.createObjectURL(blob);
                }
            }
        }

        // Initialize App
        const app = new CustomDomainBuilder();
    </script>
</body>
</html>
